<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>Redirect to LINE</title>
    <script>
      const LINE_OA_URL = "https://page.line.me/584bnrkd"; // LINE 官方網址
      const GAS_ENDPOINT =
        "https://script.google.com/macros/s/AKfycbyFTRsbSqSnI4w4t063BrGve44Ft9vrgJszAxWamlduJAXU90P2jZ2A0xhU7WgShEiz/exec";

      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      async function reportAndRedirect() {
        const data = {
          gym: getQueryParam("gym"),
          ua: navigator.userAgent,
          referrer: document.referrer,
        };

        try {
          const res = await fetch(GAS_ENDPOINT, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          const result = await res.json();
          console.log("✅ GAS 回傳結果：", result);
        } catch (err) {
          console.warn("⚠️ GAS 傳送失敗：", err);
        }

        // 延遲跳轉，確保資料寫入成功
        setTimeout(() => {
          window.location.href = LINE_OA_URL;
        }, 800);
      }

      reportAndRedirect();
    </script>
  </head>
  <body>
    <p>資料記錄中，請稍候...</p>
  </body>
</html>
